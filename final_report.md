# MQI Communicator: 최종 개발자 검토 보고서

**검토 일자:** 2025-08-20
**검토자:** Jules (AI 최종 개발자)

## 1. 총평 (Executive Summary)

MQI Communicator 프로젝트는 전반적으로 우수한 구조와 높은 테스트 커버리지(97%)를 갖추고 있어 긍정적입니다. 개발팀은 TDD 및 코드 품질 가이드라인을 준수하려는 노력을 분명히 보여주었습니다.

하지만, **치명적인 보안 취약점**과 **품질 보증(QA) 프로세스의 중대한 결함**을 포함한 몇 가지 심각한 문제가 발견되었습니다. 아래 지적된 문제들이 해결되기 전까지는 시스템을 운영 환경에 배포하는 것을 권장하지 않습니다. 특히 보안 및 프로세스 관련 문제는 최우선으로 해결해야 합니다.

## 2. 발견된 문제점 및 해결 방안

### 2.1. 치명적 (Critical) 문제

#### 1) **보안: 셸 인젝션(Shell Injection) 취약점**
- **파일:** `src/services/workflow_submitter.py`
- **문제:** `ssh`와 `scp` 명령어를 생성할 때 f-string을 사용하여 원격 경로와 명령어 문자열을 구성합니다. 만약 케이스 디렉토리 이름에 `"; rm -rf /"`와 같은 악의적인 코드가 포함될 경우, 원격 HPC 서버에서 의도치 않은 명령이 실행될 수 있는 매우 심각한 보안 허점입니다.
- **권장 해결 방안:**
    - `subprocess.run()` 함수에 명령어를 문자열이 아닌 **리스트(list) 형태**로 전달해야 합니다.
    - 셸의 도움이 필요한 `pueue` 명령어 부분은 `shlex.quote()`를 사용하여 모든 변수를 안전하게 이스케이프(escape) 처리한 후, f-string에 삽입해야 합니다.

#### 2) **프로세스:不완전한 정적 분석(MyPy) 설정**
- **파일:** `docs/development_guide.md`, `instruction.md`
- **문제:** `instruction.md`에서는 모든 함수에 타입 힌트(Type Hint)를 의무화했지만, `docs/development_guide.md`에서 안내하는 `mypy src` 명령어는 타입 힌트가 없는 함수를 에러로 보고하지 않습니다. 이로 인해 `src/main.py`와 같이 타입 힌트가 누락된 파일이 품질 검사를 통과하는 **프로세스의 허점**이 발생했습니다.
- **권장 해결 방안:**
    - `mypy` 실행 명령어에 `--disallow-untyped-defs` 플래그를 추가하여 타입 힌트가 없는 함수 정의를 에러로 처리하도록 강제해야 합니다.
    - 이 변경 사항을 `docs/development_guide.md`와 `pre-commit` 설정에 즉시 반영해야 합니다.

### 2.2. 주요 (Major) 문제

#### 1) **가이드라인 위반: 타입 힌트 누락**
- **파일:** `src/main.py`, `src/services/case_scanner.py`
- **문제:** 두 파일의 여러 함수에서 타입 힌트가 누락되어 `instruction.md`의 명시적 요구사항을 위반했습니다. 이는 코드의 명확성과 유지보수성을 저해합니다.
- **권장 해결 방안:**
    - 위의 '프로세스' 문제가 해결된 후, `mypy`가 보고하는 모든 타입 힌트 관련 에러를 수정해야 합니다. 모든 함수 정의와 주요 변수에 타입 힌트를 명시하십시오.

#### 2) **가이드라인 위반: 설정 값 하드코딩**
- **파일:** `src/main.py`, `src/services/workflow_submitter.py`
- **문제:** `config/config.yaml`을 사용하라는 가이드라인에도 불구하고, 아래 값들이 코드 내에 하드코딩되어 있습니다.
    - 로그 파일 경로 (`"communicator_local.log"`)
    - 메인 루프의 대기 시간 (`time.sleep(10)`)
    - 원격 실행 스크립트 명령어 (`"python interpreter.py && python moquisim.py"`)
- **권장 해결 방안:**
    - 위에 언급된 모든 값을 `config/config.yaml` 파일로 옮기고, 애플리케이션이 실행 시점에 이 설정들을 읽어오도록 수정해야 합니다.

### 2.3. 경미한 (Minor) 문제 및 권장 사항

#### 1) **안정성: 취약한 오류 처리 로직**
- **파일:** `src/services/case_scanner.py`
- **문제:** `on_created` 이벤트 핸들러 내에 `try...except` 블록이 없어, DB 추가 작업 중 예외가 발생하면 `watchdog` 스레드가 불안정해지거나 중단될 수 있습니다.
- **권장 해결 방안:** `db_manager.add_case` 호출을 `try...except` 블록으로 감싸고, 실패 시 명확한 에러 로그를 남기도록 수정하여 안정성을 높여야 합니다.

#### 2) **일관성: 테스트 스타일 불일치**
- **파일:** `tests/test_dashboard.py`
- **문제:** 프로젝트의 다른 모든 테스트 파일은 `pytest` 스타일로 작성되었으나, 이 파일만 `unittest.TestCase` 스타일을 사용하고 있어 일관성이 떨어집니다.
- **권장 해결 방안:** `pytest` 스타일로 리팩토링하여 테스트 코드의 통일성을 유지하는 것이 좋습니다.

#### 3) **품질: 피상적인 대시보드 테스트**
- **파일:** `tests/test_dashboard.py`
- **문제:** 대시보드 테스트는 기능이 오류 없이 실행되는지만 확인하는 '스모크 테스트' 수준에 머물러 있습니다. 실제 출력 내용의 정확성은 전혀 검증하지 않습니다.
- **권장 해결 방안:** 대시보드에 표시될 테이블의 구조나 내용의 일부를 검증하는 어설션(assertion)을 추가하여 테스트의 깊이를 더해야 합니다.

#### 4) **품질: 제네릭 예외(Exception) 사용**
- **파일:** `src/services/workflow_submitter.py`
- **문제:** `subprocess.CalledProcessError`를 잡은 후, 구체적인 커스텀 예외 대신 제네릭 `Exception`을 발생시킵니다. 이는 오류 처리 로직에서 세분화된 대응을 어렵게 만듭니다.
- **권장 해결 방안:** `WorkflowSubmissionError`와 같은 커스텀 예외 클래스를 정의하고 사용하여, 호출하는 쪽에서 오류 유형에 따라 다른 처리를 할 수 있도록 개선해야 합니다.

## 3. 결론

본 프로젝트는 성공적인 완수를 위한 견고한 기반을 갖추고 있습니다. 그러나 발견된 보안 및 프로세스 문제를 해결하는 것이 시급합니다. 위에서 제안된 해결 방안들을 적용하여 코드의 안정성과 보안성을 확보한 후, 재검토를 진행할 것을 권장합니다.
